grammar AsciidoctorGrammar

  rule text
    (quoted)* <Text>
  end

  rule quoted
    (escaped_quoted_symbol / unconstrained_strong / unconstrained_emphasis / unconstrained_mark / strong / emphasis / monospaced / mark / superscript / subscript / ' ' / word / symbol)+ <Expression>
  end

  rule strong
    (!constrained_invalid_start) '*' (!spaces) strong_content (!spaces) '*' (!constrained_invalid_end) <StrongQuoted>
  end

  rule unconstrained_strong
    '**' strong_content '**' <StrongQuoted>
  end

  rule strong_content
    (strong_content_greedy)+ <QuotedContent>
  end

  rule strong_content_greedy
    ( [^*] / '*' constrained_invalid_mark )
  end

  rule emphasis
    (!constrained_invalid_start) '_' (!spaces) emphasis_content (!spaces) '_' (!constrained_invalid_end) <EmphasisQuoted>
  end

  rule unconstrained_emphasis
    '__' emphasis_content '__' <EmphasisQuoted>
  end

  rule emphasis_content
    (emphasis_content_greedy)+ <QuotedContent>
  end

  rule emphasis_content_greedy
    ( [^_] / '_' constrained_invalid_mark )
  end

  rule monospaced
    (!constrained_invalid_start) '`' monospaced_content '`' (!constrained_invalid_end) <MonospacedQuoted>
  end

  rule monospaced_content
    [^`]+ <QuotedContent>
  end

  rule mark
    (!constrained_invalid_start) '#' mark_content '#' (!constrained_invalid_end) <MarkQuoted>
  end

  rule unconstrained_mark
    '##' mark_content '##' <MarkQuoted>
  end

  rule mark_content
    [^#]+ <QuotedContent>
  end

  rule superscript
    (!constrained_invalid_start) '^' superscript_content '^' (!constrained_invalid_end) <SuperscriptQuoted>
  end

  rule superscript_content
    [^\^]+ <QuotedContent>
  end

  rule subscript
    (!constrained_invalid_start) '~' (!spaces) subscript_content (!spaces) '~' (!constrained_invalid_end) <SubscriptQuoted>
  end

  rule subscript_content
    [^~]+ <QuotedContent>
  end

  rule constrained_invalid_start
    ( constrained_invalid_mark / ':' / ';' / '}' )
  end

  rule constrained_invalid_end
    ( constrained_invalid_mark )
  end

  rule constrained_invalid_mark
    [a-zA-Z0-9]
  end

  rule spaces
    [ ]+
  end

  rule word
    [0-9a-zA-Z]+
  end

  rule number
    [0-9]+
  end

  rule escaped_quoted_symbol
    ( '\*' / '\_' / '\`' / '\#' / '\^' / '\~' )
  end

  rule symbol
    [-=;:},"'\.!_*#\\]+
  end
end
